// ==============================================
// Event Service - Prisma Schema
// Schema: event_schema
// Purpose: Core event management data
// ==============================================

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// Event model - stores event information
model Event {
  id          String   @id @default(uuid())
  title       String
  description String?  @db.Text
  date        DateTime
  startTime   String?  @map("start_time")
  endTime     String?  @map("end_time")
  location    String?
  venueId     String?  @map("venue_id")     // External venue reference (from LOGe)
  venueName   String?  @map("venue_name")   // Cached venue name for display
  capacity    Int      @default(100)
  status      EventStatus @default(PUBLISHED)
  createdBy   String   @map("created_by")   // User ID of creator (admin)
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  // Relations
  participants EventParticipant[]

  @@map("events")
}

// Event participant - tracks user registrations
model EventParticipant {
  id          String   @id @default(uuid())
  eventId     String   @map("event_id")
  userId      String   @map("user_id")
  userName    String?  @map("user_name")    // Cached for display
  userEmail   String?  @map("user_email")   // Cached for display
  registeredAt DateTime @default(now()) @map("registered_at")

  // Relations
  event       Event    @relation(fields: [eventId], references: [id], onDelete: Cascade)

  // Unique constraint: user can only register once per event
  @@unique([eventId, userId])
  @@map("event_participants")
}

// Event status enum
enum EventStatus {
  DRAFT
  PUBLISHED
  CANCELLED
  COMPLETED
}
